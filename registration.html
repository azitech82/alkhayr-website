<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registration | Akademi Al Khayr</title>
    <link rel="icon" type="image/png" href="logo%20AAK%20(white%20BG).png">
    <meta name="description" content="Register for Akademi Al Khayr programs.">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        body {
            font-family: 'Poppins', sans-serif;
        }
        .receipt-input {
            font-size: 1rem;
            font-weight: 400;
            color: #111827;
        }
        .receipt-view {
            position: absolute;
            top: -9999px;
            left: -9999px;
            width: 1024px;
            background: #ffffff;
            padding: 2.5rem 2.75rem 2.25rem;
            border-radius: 1.5rem;
            box-shadow: 0 18px 45px rgba(15, 23, 42, 0.18);
            color: #111827;
            border: 1px solid rgba(148, 163, 184, 0.35);
        }
        .receipt-header-strip {
            height: 6px;
            width: 100%;
            border-radius: 9999px;
            background: linear-gradient(90deg, #7c3aed, #a855f7, #22c55e);
            margin-bottom: 1.75rem;
        }
        .receipt-header-main {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 2rem;
            margin-bottom: 1.25rem;
        }
        .receipt-subtitle {
            font-size: 0.9rem;
            color: #9ca3af;
        }
        .receipt-date {
            font-size: 0.9rem;
            color: #6b7280;
        }
        .receipt-date span {
            color: #7c3aed;
            font-weight: 500;
        }
        .receipt-section {
            margin-bottom: 1.25rem;
            padding: 1rem 1.25rem;
            border-radius: 1rem;
            background: linear-gradient(135deg, #f9fafb, #eef2ff);
            border: 1px solid rgba(148, 163, 184, 0.35);
        }
        .receipt-section-title {
            font-size: 1.05rem;
            font-weight: 600;
            color: #111827;
            margin-bottom: 0.75rem;
        }
        .receipt-row {
            display: flex;
            justify-content: space-between;
            gap: 2rem;
            margin-bottom: 0.45rem;
            font-size: 0.95rem;
        }
        .receipt-label {
            font-weight: 500;
            color: #374151;
        }
        .receipt-value {
            font-weight: 500;
            text-align: right;
            color: #111827;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <!-- Navigation -->
    <nav class="bg-white/75 backdrop-blur fixed w-full z-50 shadow-sm transition-all duration-300">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-20 items-center">
                <a href="index.html" class="flex items-center">
                    <img src="logo%20AAK%20(white%20BG).png" alt="Akademi Al Khayr Logo" class="h-16 w-auto object-contain mr-3">
                    <div>
                        <h1 class="text-xl font-bold text-gray-900 leading-none tracking-tight">AKADEMI</h1>
                        <h1 class="text-xl font-bold text-purple-600 leading-none tracking-tight">AL KHAYR</h1>
                    </div>
                </a>
                <div class="hidden md:flex space-x-8">
                    <a href="index.html" class="text-gray-600 hover:text-purple-600 font-medium transition">Home</a>
                    <a href="about.html" class="text-gray-600 hover:text-purple-600 font-medium transition">About</a>
                    <a href="index.html#programs" class="text-gray-600 hover:text-purple-600 font-medium transition">Programs</a>
                    <a href="index.html#contact" class="text-gray-600 hover:text-purple-600 font-medium transition">Contact</a>
                </div>
                <button id="mobile-menu-button" class="md:hidden inline-flex items-center justify-center w-10 h-10 rounded-full border border-gray-300 text-gray-600 hover:bg-gray-100 transition">
                    <i id="mobile-menu-icon" class="fas fa-bars text-lg"></i>
                </button>
            </div>
            <div id="mobile-menu" class="md:hidden hidden pb-4">
                <div class="mobile-menu-panel bg-white/95 rounded-2xl shadow-xl border border-white/40 px-4 py-4 space-y-3">
                    <a href="index.html" class="block font-semibold text-gray-800">Home</a>
                    <a href="about.html" class="block font-semibold text-gray-800">About</a>
                    <a href="index.html#programs" class="block font-semibold text-gray-800">Programs</a>
                    <a href="index.html#contact" class="block font-semibold text-gray-800">Contact</a>
                    <a href="fees.html" class="block font-semibold text-gray-800">Fees payment</a>
                    <a href="Download/AAK%20TAKWIM%202026.pdf" target="_blank" class="block font-semibold text-gray-800">AAK Takwim 2026</a>
                    <a href="Download/GuideBook%20AAK_2026%20(1).pdf" target="_blank" class="block font-semibold text-gray-800">Guidebook AAK 2026</a>
                    <a href="gallery.html" class="block font-semibold text-gray-800">Gallery</a>
                    <a href="index.html#location" class="block font-semibold text-gray-800">Visit</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Registration Form Section -->
    <section class="min-h-screen pt-32 pb-16 px-4 sm:px-6 lg:px-8 bg-gray-50 flex items-center justify-center">
        <div class="max-w-3xl w-full bg-white rounded-2xl shadow-xl overflow-hidden">
            <div class="bg-purple-600 py-6 px-8 text-center">
                <div class="flex justify-center mb-4">
                    <img src="logo%20AAK%20(white%20BG).png" alt="Akademi Al Khayr Logo" class="h-20 w-auto object-contain">
                </div>
                <h2 class="text-3xl font-bold text-white">School Registration Form</h2>
                <p class="text-purple-100 mt-2">Join Akademi Al Khayr today</p>
            </div>
            
            <form id="registrationForm" class="py-8 px-8 sm:px-12 space-y-6" action="https://formsubmit.co/ajax/akademialkhayrofficial@gmail.com" method="POST">
                <input type="hidden" name="_gotcha" style="display:none !important">
                <div style="position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden;">
                    <label for="aak_hp">Do not fill</label>
                    <input id="aak_hp" type="text" name="aak_hp" tabindex="-1" autocomplete="off" inputmode="text">
                </div>
                <input id="aak_time" type="hidden" name="aak_time" value="">

                <!-- Student Details -->
                <div class="space-y-6">
                    <h3 class="text-xl font-semibold text-gray-900 border-b pb-2">Student Information</h3>
                    
                    <div>
                        <label for="studentName" class="block text-sm font-medium text-gray-700 mb-1">Name of Student</label>
                        <input type="text" id="studentName" name="studentName" class="w-full px-5 pt-1 pb-5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 outline-none transition receipt-input" placeholder="Enter student's full name" required>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="age" class="block text-sm font-medium text-gray-700 mb-1">Age</label>
                            <input type="number" id="age" name="age" class="w-full px-5 pt-2 pb-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 outline-none transition receipt-input" placeholder="Enter age" required>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Level of Education</label>
                            <div class="flex space-x-4 mt-2">
                                <label class="inline-flex items-center">
                                    <input type="radio" name="educationLevel" value="primary" class="form-radio text-purple-600 focus:ring-purple-500 h-4 w-4" required>
                                    <span class="ml-2 text-gray-700">Primary Level</span>
                                </label>
                                <label class="inline-flex items-center">
                                    <input type="radio" name="educationLevel" value="secondary" class="form-radio text-purple-600 focus:ring-purple-500 h-4 w-4">
                                    <span class="ml-2 text-gray-700">Secondary Level</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div>
                        <label for="currentSchool" class="block text-sm font-medium text-gray-700 mb-1">Current School</label>
                        <input type="text" id="currentSchool" name="currentSchool" class="w-full px-5 pt-2 pb-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 outline-none transition receipt-input" placeholder="Enter current school name">
                    </div>
                </div>

                <!-- Parent/Guardian Details -->
                <div class="space-y-6 pt-6">
                    <h3 class="text-xl font-semibold text-gray-900 border-b pb-2">Parent/Guardian Information</h3>
                    
                    <div>
                        <label for="parentName" class="block text-sm font-medium text-gray-700 mb-1">Name of Parent/Guardian</label>
                        <input type="text" id="parentName" name="parentName" class="w-full px-5 pt-2 pb-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 outline-none transition receipt-input" placeholder="Enter parent/guardian's full name" required>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="contactNo" class="block text-sm font-medium text-gray-700 mb-1">Contact No</label>
                            <input type="tel" id="contactNo" name="contactNo" class="w-full px-5 pt-2 pb-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 outline-none transition receipt-input" placeholder="Enter contact number" required>
                        </div>
                        
                        <div>
                            <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
                            <input type="email" id="email" name="email" class="w-full px-5 pt-2 pb-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 outline-none transition receipt-input" placeholder="Enter email address" required>
                        </div>
                    </div>

                    <div>
                        <label for="occupation" class="block text-sm font-medium text-gray-700 mb-1">Parent/Guardian Occupation</label>
                        <input type="text" id="occupation" name="occupation" class="w-full px-5 pt-2 pb-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 outline-none transition receipt-input" placeholder="Enter occupation">
                    </div>
                </div>

                <div class="pt-6">
                    <button type="submit" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-4 rounded-lg shadow-md hover:shadow-lg transition duration-300 transform hover:-translate-y-0.5">
                        Submit Registration
                    </button>
                </div>
            </form>

            <div id="receiptView" class="receipt-view">
                <div class="receipt-header-strip"></div>
                <div class="receipt-header-main">
                    <div class="flex items-center gap-3">
                        <img src="logo%20AAK%20(white%20BG).png" alt="Akademi Al Khayr Logo" class="h-14 w-auto object-contain">
                        <div>
                            <h2 class="text-2xl font-bold text-gray-900">Akademi Al Khayr</h2>
                            <p class="receipt-subtitle">Student Registration Receipt</p>
                        </div>
                    </div>
                    <div class="text-right receipt-date">
                        <span id="receiptDate"></span>
                    </div>
                </div>

                <div class="receipt-section">
                    <h3 class="receipt-section-title">Student Information</h3>
                    <div class="receipt-row">
                        <span class="receipt-label">Name of Student</span>
                        <span class="receipt-value" id="receiptStudentName"></span>
                    </div>
                    <div class="receipt-row">
                        <span class="receipt-label">Age</span>
                        <span class="receipt-value" id="receiptAge"></span>
                    </div>
                    <div class="receipt-row">
                        <span class="receipt-label">Level of Education</span>
                        <span class="receipt-value" id="receiptEducationLevel"></span>
                    </div>
                    <div class="receipt-row">
                        <span class="receipt-label">Current School</span>
                        <span class="receipt-value" id="receiptCurrentSchool"></span>
                    </div>
                </div>

                <div class="receipt-section">
                    <h3 class="receipt-section-title">Parent/Guardian Information</h3>
                    <div class="receipt-row">
                        <span class="receipt-label">Name of Parent/Guardian</span>
                        <span class="receipt-value" id="receiptParentName"></span>
                    </div>
                    <div class="receipt-row">
                        <span class="receipt-label">Contact No</span>
                        <span class="receipt-value" id="receiptContactNo"></span>
                    </div>
                    <div class="receipt-row">
                        <span class="receipt-label">Email Address</span>
                        <span class="receipt-value" id="receiptEmail"></span>
                    </div>
                    <div class="receipt-row">
                        <span class="receipt-label">Occupation</span>
                        <span class="receipt-value" id="receiptOccupation"></span>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer (Simplified) -->
    <footer class="bg-gray-900 text-white py-8 border-t border-gray-800">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <p class="text-gray-400 text-sm">&copy; 2026 Akademi Al Khayr. All rights reserved.</p>
        </div>
    </footer>

    <script>
        const registrationForm = document.getElementById('registrationForm');
        const registrationInitAt = Date.now();
        const registrationHoneypot = document.getElementById('aak_hp');
        const registrationLoadTime = document.getElementById('aak_time');
        if (registrationLoadTime) {
            registrationLoadTime.value = String(registrationInitAt);
        }

        let registrationFirstInteractionAt = null;
        const markRegistrationInteraction = () => {
            if (registrationFirstInteractionAt === null) {
                registrationFirstInteractionAt = Date.now();
            }
        };
        ['pointerdown', 'keydown', 'touchstart', 'focusin'].forEach((eventName) => {
            window.addEventListener(eventName, markRegistrationInteraction, { once: true, capture: true });
        });

        registrationForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const form = this;

            const studentName = document.getElementById('studentName').value;
            const age = document.getElementById('age').value;
            const educationLevel = document.querySelector('input[name="educationLevel"]:checked').value;
            const currentSchool = document.getElementById('currentSchool').value || 'N/A';
            const parentName = document.getElementById('parentName').value;
            const contactNo = document.getElementById('contactNo').value;
            const email = document.getElementById('email').value;
            const occupation = document.getElementById('occupation').value || 'N/A';
            const date = new Date().toLocaleDateString();

            const now = Date.now();
            const elapsedMs = now - registrationInitAt;
            const isWebDriver = navigator.webdriver === true;
            const rateLimitKey = 'aak_registration_last_submit_at';
            const lastSubmitAt = Number(localStorage.getItem(rateLimitKey) || '0');

            if (registrationHoneypot && registrationHoneypot.value.trim() !== '') {
                alert('Please try again.');
                return;
            }

            if (registrationFirstInteractionAt === null) {
                alert('Please interact with the page and try again.');
                return;
            }

            if (elapsedMs < 3500 || (isWebDriver && elapsedMs < 8000)) {
                alert('Please wait a moment and submit again.');
                return;
            }

            if (lastSubmitAt && now - lastSubmitAt < 45000) {
                alert('Please wait a moment before submitting again.');
                return;
            }

            localStorage.setItem(rateLimitKey, String(now));

            const whatsappText = `
*New Student Registration*
------------------------
*Student:* ${studentName}
*Age:* ${age}
*Level:* ${educationLevel}
*Parent:* ${parentName}
*Contact:* ${contactNo}
            `.trim();

            const whatsappLink = `https://wa.me/60193818616?text=${encodeURIComponent(whatsappText)}`;

            document.getElementById('receiptStudentName').textContent = studentName || '-';
            document.getElementById('receiptAge').textContent = age || '-';
            document.getElementById('receiptEducationLevel').textContent = educationLevel || '-';
            document.getElementById('receiptCurrentSchool').textContent = currentSchool || '-';
            document.getElementById('receiptParentName').textContent = parentName || '-';
            document.getElementById('receiptContactNo').textContent = contactNo || '-';
            document.getElementById('receiptEmail').textContent = email || '-';
            document.getElementById('receiptOccupation').textContent = occupation || '-';
            document.getElementById('receiptDate').textContent = date;

            window.open(whatsappLink, '_blank');
            
            const formElement = document.getElementById('receiptView');
            
            const submitBtn = document.querySelector('button[type="submit"]');
            const originalBtnText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Generating Receipt...';
            submitBtn.disabled = true;

            const submitFormAjax = (receiptBlob, receiptFileName) => {
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Submitting...';
                submitBtn.disabled = true;
                
                const formData = new FormData(form);
                if (receiptBlob) {
                    formData.append('receipt_image', receiptBlob, receiptFileName || 'AAK-Registration-Receipt.png');
                }
                fetch(form.action, {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'Accept': 'application/json'
                    }
                })
                .then(response => {
                    submitBtn.innerHTML = originalBtnText;
                    submitBtn.disabled = false;
                    if (response.ok) {
                        console.log('Form submitted successfully');
                    } else {
                        console.warn('Form submission issue:', response.status);
                        alert("Note: We couldn't automatically send the registration to our system. Please ensure you send the receipt via WhatsApp.");
                    }
                })
                .catch(error => {
                    console.error('Form submission error:', error);
                    submitBtn.innerHTML = originalBtnText;
                    submitBtn.disabled = false;
                    localStorage.removeItem(rateLimitKey);
                    alert("Note: We couldn't automatically send the registration to our system. Please ensure you send the receipt via WhatsApp.");
                });
            };

            const generateReceipt = (scale) => {
                html2canvas(formElement, {
                    scale,
                    backgroundColor: '#ffffff',
                    useCORS: true
                }).then(canvas => {
                    const fileName = `AAK-Registration-${studentName.replace(/\s+/g, '-')}.png`;
                    canvas.toBlob((blob) => {
                        if (blob) {
                            const url = URL.createObjectURL(blob);
                            const link = document.createElement('a');
                            link.download = fileName;
                            link.href = url;
                            document.body.appendChild(link);
                            link.click();
                            document.body.removeChild(link);
                            URL.revokeObjectURL(url);

                            alert(`Registration Receipt Downloaded!\n\nA copy is also being sent to the school email automatically.`);
                            submitFormAjax(blob, fileName);
                        } else {
                            alert('Could not generate image receipt file, but proceeding with submission.');
                            submitFormAjax();
                        }
                    }, 'image/png');
                }).catch(err => {
                    console.error('Image generation failed at scale', scale, err);
                    if (scale > 1) {
                        generateReceipt(1);
                    } else {
                        alert('Could not generate image receipt, but proceeding with submission.');
                        submitFormAjax();
                    }
                });
            };

            generateReceipt(2);
        });
    </script>

    <!-- Watermarks -->
    <div class="fixed bottom-[-5%] left-[-5%] z-0 pointer-events-none opacity-[0.03] select-none" style="width: 40vw; max-width: 500px;">
        <img src="logo%20AAK%20(white%20BG).png" class="w-full h-auto grayscale" alt="">
    </div>

    <script>
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');
        const mobileMenuIcon = document.getElementById('mobile-menu-icon');
        if (mobileMenuButton && mobileMenu && mobileMenuIcon) {
            mobileMenuButton.addEventListener('click', () => {
                const isOpen = !mobileMenu.classList.contains('hidden');
                mobileMenu.classList.toggle('hidden');
                mobileMenuIcon.classList.toggle('fa-bars', isOpen);
                mobileMenuIcon.classList.toggle('fa-times', !isOpen);
            });
            mobileMenu.querySelectorAll('a').forEach((link) => {
                link.addEventListener('click', () => {
                    mobileMenu.classList.add('hidden');
                    mobileMenuIcon.classList.add('fa-bars');
                    mobileMenuIcon.classList.remove('fa-times');
                });
            });
        }
    </script>
</body>
</html>
